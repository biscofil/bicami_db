
$(document).ready(function(){adminInit("Nuova compagnia","Modifica compagnia","xhr_compagnie","xhr_elimina_compagnie","Compagnie eliminate");$("#id_paese").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_paese",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.code;f.paese=d.name;f.code2=d.code2;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona un paese",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatPaese,templateSelection:function(a){return a.paese||a.text}});$("#btn_save").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_nuova_compagnia",data:{nome:$("#nome").val(),id_paese:$("#id_paese").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Compagnia inserita","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_update").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_compagnia",data:{id:editing_old_id,nome:$("#nome").val(),id_paese:$("#id_paese").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Compagnia modificata","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_edit").click(function(){editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_compagnia",data:{id:editing_old_id}}).done(function(a){if(a.result===1){_modal=$("#exampleModal").modal("show");_modal.find("#nome").val(a.compagnia.nome);_modal.find("#id_paese").append('<option value="'+a.compagnia.nazionalita+'" selected="selected">'+a.compagnia.nazionalita+"</option>");_modal.find("#id_paese").trigger("change");modal.modal("show")}else{$.notify(a.error,"error")}})})});