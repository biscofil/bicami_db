$(document).ready(function(){adminInit("Nuova prenotazione","Modifica prenotazione","xhr_prenotazioni","xhr_elimina_prenotazioni","Prenotazioni eliminate");$("#id_volo").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_volo",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.id;f.codice=d.codice;f.data_ora=d.data_ora;f.nome_aeroplano=d.nome_aeroplano;f.nome_compagnia=d.nome_compagnia;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona un volo",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatVolo,templateSelection:function(a){return a.codice||a.text}});$("#classe").select2();$("#id_utente").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_utente",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.id;f.nome=d.nome;f.cognome=d.cognome;f.indirizzo=d.indirizzo;f.telefono=d.telefono;f.username=d.username;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona un utente",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatUtente,templateSelection:function(a){return a.nome?(a.nome+" "+a.cognome):a.text}});$("#btn_save").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_prenota",data:{id_volo:$("#id_volo").val(),id_utente:$("#id_utente").val(),classe:$("#classe").val(),passeggeri:$("#posti").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Prenotazione effettuata","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_update").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_prenotazione",data:{id:editing_old_id,id_volo:$("#id_volo").val(),id_utente:$("#id_utente").val(),classe:$("#classe").val(),passeggeri:$("#posti").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Prenotazione modificata","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_edit").click(function(){editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_prenotazione",data:{id:editing_old_id}}).done(function(a){if(a.result===1){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_utente",data:{id:a.prenotazione.id_utente}}).done(function(b){_modal.find("#posti").val(a.prenotazione.num_posti_prenotati);_modal.find("#id_utente").append('<option value="'+a.prenotazione.id_utente+'" selected="selected">'+b.utente.nome+" "+b.utente.cognome+"</option>");_modal.find("#id_utente").trigger("change");_modal.find("#id_volo").append('<option value="'+a.prenotazione.id_volo_pianificato+'" selected="selected">'+a.prenotazione.id_volo_pianificato+"</option>");_modal.find("#id_volo").trigger("change");_modal.find("#classe").val(a.prenotazione.classe).trigger("change");_modal.modal("show")})}else{$.notify(a.error,"error")}})})});