
$(document).ready(function(){adminInit("Nuovo utente","Modifica utente","xhr_utenti","xhr_elimina_utenti","Utenti eliminati");$("#btn_save").click(function(){if($("#password").val()===$("#password_confirm").val()){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(b){if(b){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_nuovo_utente",data:{nome:$("#nome").val(),cognome:$("#cognome").val(),telefono:$("#telefono").val(),indirizzo:$("#indirizzo").val(),carta_credito:$("#carta_credito").val(),user_level:$("#admin").prop("checked")?1:0,username:$("#username").val(),password:$("#password").val()}}).done(function(c){if(c.result===1){_modal.modal("hide");$.notify("Utente inserito","success");table.ajax.reload(null,false)}else{$.notify(c.error,"error")}})}})}}else{$.notify("Le password non combaciano","error")}});function a(){bootbox.confirm("Procedere?",function(b){if(b){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_utente",data:{id:editing_old_id,nome:$("#nome").val(),cognome:$("#cognome").val(),telefono:$("#telefono").val(),indirizzo:$("#indirizzo").val(),carta_credito:$("#carta_credito").val(),user_level:$("#admin").prop("checked")?1:0,username:$("#username").val(),password:$("#password").val()?$("#password").val():null}}).done(function(c){if(c.result===1){_modal.modal("hide");$.notify("Utente modificato","success");table.ajax.reload(null,false)}else{$.notify(c.error,"error")}})}})}$("#btn_update").click(function(){if($("#password").val()||$("#password_confirm").val()){if($("#password").val()===$("#password_confirm").val()){if(requiredFieldsCheck()){$.notify("Modifico anche la password","info");a()}}else{$.notify("Le password non combaciano","error")}}else{$.notify("Modifico lasciando la password invariata","info");a()}});$("#btn_new").click(function(){_modal.find("#password").prop("required",true);_modal.find("#password_confirm").prop("required",true);_modal.find("#password").attr("placeholder","Password");_modal.find("#password_confirm").attr("placeholder","Conferma password")});$("#btn_edit").click(function(){_modal.find("#password").prop("required",false);_modal.find("#password_confirm").prop("required",false);_modal.find("#password").attr("placeholder","Lasciare vuoto per lasciare la password invariata");_modal.find("#password_confirm").attr("placeholder","Lasciare vuoto per lasciare la password invariata");editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_utente",data:{id:editing_old_id}}).done(function(b){if(b.result===1){_modal.find("#nome").val(b.utente.nome);_modal.find("#cognome").val(b.utente.cognome);_modal.find("#telefono").val(b.utente.telefono);_modal.find("#indirizzo").val(b.utente.indirizzo);_modal.find("#carta_credito").val(b.utente.carta_credito);_modal.find("#admin").prop("checked",b.utente.user_level==1);_modal.find("#username").val(b.utente.username);_modal.find("#password, #password_confirm").val("");_modal.modal("show")}else{$.notify(b.error,"error")}})})});