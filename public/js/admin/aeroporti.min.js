
$(document).ready(function(){adminInit("Nuovo aeroporto","Modifica aeroporto","xhr_aeroporti","xhr_elimina_aeroporti","Aeroporti eliminati");$("#citta").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_citta",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.id_citta;f.citta=d.nome_citta;f.id_paese=d.id_paese;f.paese=d.nome_paese;f.code2=d.code2;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona una citta",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatCitta,templateSelection:function(a){return a.citta||a.text}});$("#btn_save").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_nuovo_aeroporto",data:{sigla:$("#sigla").val(),nome:$("#nome").val(),id_citta:$("#citta").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Aeroporto inserito","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_update").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_aeroporto",data:{old_sigla:editing_old_id,sigla:$("#sigla").val(),nome:$("#nome").val(),id_citta:$("#citta").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Aeroporto modificato","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_edit").click(function(){editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_aeroporto",data:{sigla:editing_old_id}}).done(function(a){if(a.result===1){_modal.find("#sigla").val(a.aeroporto.sigla);_modal.find("#nome").val(a.aeroporto.nome);_modal.find("#citta").append('<option value="'+a.aeroporto.id_citta+'" selected="selected">'+a.aeroporto.nome_citta+"</option>");_modal.find("#citta").trigger("change");modal.modal("show")}else{$.notify(a.error,"error")}})})});