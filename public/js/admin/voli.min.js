
$(document).ready(function(){adminInit("Nuovo volo","Modifica volo","xhr_voli","xhr_elimina_voli","Voli eliminati");$("#data").datetimepicker({controlType:"select",oneLine:true,timeFormat:"HH:mm",minDate:"+5d",dateFormat:"dd/mm/yy"});$("#tratta").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_tratta",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.codice;f.name=d.codice;f.value=d.codice;f.from=d.aeroporto_partenza;f.to=d.aeroporto_arrivo;f.cod_compagnia=d.cod_compagnia;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona una tratta",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatTratta,templateSelection:function(a){return a.name||a.text}});$("#btn_save").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_nuovo_volo",data:{tratta:$("#tratta").val(),data:$("#data").val(),gate:$("#gate").val(),ritardo:$("#ritardo").val(),cancellato:$("#cancellato").prop("checked")?1:0}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Volo inserito","success");$("#cancellato").prop("checked",false);table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_update").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_volo",data:{old_codice:editing_old_id,tratta:$("#tratta").val(),data:$("#data").val(),gate:$("#gate").val(),ritardo:$("#ritardo").val(),cancellato:$("#cancellato").prop("checked")?1:0}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Tratta modificata","success");$("#cancellato").prop("checked",false);table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_edit").click(function(){editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_volo",data:{codice:editing_old_id}}).done(function(a){if(a.result===1){_modal.find("#tratta").append('<option value="'+a.volo.codice_volo+'" selected="selected">'+a.volo.codice_volo+"</option>");_modal.find("#tratta").trigger("change");_modal.find("#gate").val(a.volo.gate);_modal.find("#ritardo").val(a.volo.ritardo);_modal.find("#cancellato").prop("checked",a.volo.cancellato);_modal.find("#data").val(a.volo.data_ora);_modal.find("#btn_save").addClass("hidden");_modal.find("#btn_update").removeClass("hidden");_modal.find("#title_action").text("Modifica");_modal.modal("show")}else{$.notify(a.error,"error")}})})});