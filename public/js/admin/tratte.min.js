
$(document).ready(function(){adminInit("Nuova tratta","Modifica tratta","xhr_tratte","xhr_elimina_tratte","Tratte eliminate");$("#a_partenza,#a_arrivo").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_aeroporto",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.sigla;f.name=d.nome;f.value=d.sigla;f.citta=d.nome_citta;f.paese=d.nome_paese;f.code2=d.code2;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona un aeroporto",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatAeroporto,templateSelection:function(a){return a.name||a.text}});$("#compagnia").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_compagnia",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.id;f.name=d.nome;f.value=d.id;f.paese=d.paese;f.code2=d.code2;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona una compagnia",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatCompagnia,templateSelection:function(a){return a.name||a.text}});$("#aeroplano").select2({dropdownParent:$("#exampleModal"),ajax:{url:__site_url+"/"+__xhr_controller+"/xhr_search_aeroplano",dataType:"json",delay:250,data:function(a){return{q:a.term}},processResults:function(c,b){var a=[];$.each(c,function(e,d){var f={};f.id=d.id;f.name=d.nome;f.p_economy=d.posti_economy;f.p_business=d.posti_business;a.push(f)});return{results:a}},cache:true},placeholder:"Seleziona un aeroplano",escapeMarkup:function(a){return a},minimumInputLength:2,templateResult:formatAeroplano,templateSelection:function(a){return a.name||a.text}});$("#btn_save").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_nuova_tratta",data:{codice:$("#codice").val(),compagnia:$("#compagnia").val(),a_partenza:$("#a_partenza").val(),a_arrivo:$("#a_arrivo").val(),durata:$("#durata").val(),p_economy:$("#p_economy").val(),p_business:$("#p_business").val(),aeroplano:$("#aeroplano").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Tratta inserita","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_update").click(function(){if(requiredFieldsCheck()){bootbox.confirm("Procedere?",function(a){if(a){$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_modifica_tratta",data:{old_codice:editing_old_id,codice:$("#codice").val(),compagnia:$("#compagnia").val(),a_partenza:$("#a_partenza").val(),a_arrivo:$("#a_arrivo").val(),durata:$("#durata").val(),p_economy:$("#p_economy").val(),p_business:$("#p_business").val(),aeroplano:$("#aeroplano").val()}}).done(function(b){if(b.result===1){_modal.modal("hide");$.notify("Tratta modificata","success");table.ajax.reload(null,false)}else{$.notify(b.error,"error")}})}})}});$("#btn_edit").click(function(){editing_old_id=$(".selected:first").data("id");$.ajax({type:"POST",cache:false,url:__site_url+"/"+__xhr_controller+"/xhr_tratta",data:{codice:editing_old_id}}).done(function(a){if(a.result===1){_modal.find("#codice").val(a.tratta.codice);_modal.find("#compagnia").append('<option value="'+a.tratta.cod_compagnia+'" selected="selected">'+a.tratta.nome_compagnia+"</option>");_modal.find("#compagnia").trigger("change");_modal.find("#a_partenza").append('<option value="'+a.tratta.aeroporto_partenza+'" selected="selected">'+a.tratta.aeroporto_partenza+"</option>");_modal.find("#a_partenza").trigger("change");_modal.find("#a_arrivo").append('<option value="'+a.tratta.aeroporto_arrivo+'" selected="selected">'+a.tratta.aeroporto_arrivo+"</option>");_modal.find("#a_arrivo").trigger("change");_modal.find("#durata").val(a.tratta.durata_volo);_modal.find("#p_economy").val(a.tratta.prezzo_economy);_modal.find("#p_business").val(a.tratta.prezzo_business);$("#aeroplano").append('<option value="'+a.tratta.tipo_aeroplano+'" selected="selected">'+a.tratta.nome_aeroplano+"</option>");$("#aeroplano").trigger("change");_modal.modal("show")}else{$.notify(a.error,"error")}})})});