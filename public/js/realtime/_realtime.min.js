var geocoder;var map;var bounds;var markerImage;function initMap(){bounds=new google.maps.LatLngBounds();geocoder=new google.maps.Geocoder();map=new google.maps.Map(document.getElementById("map"),{center:{lat:-34.397,lng:150.644},zoom:8,styles:[{stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#337ab7"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#e1e1e1"},{visibility:"on"}]}]});var a=__base_url+"/public/img/";markerImage=new google.maps.MarkerImage(a+"Plane.png",new google.maps.Size(128,128),new google.maps.Point(0,0),new google.maps.Point(64,64))}function geocode_2(j){address1=j.da_citta+", "+j.da_paese;address2=j.a_citta+", "+j.a_paese;var f=new Date(j.data_ora);var i=new Date().getTime()/1000;var c=(f.getTime()/1000)+(j.ritardo*60);var e=c+(j.durata_volo*60);var a=e-c;var b=i-c;var h=(b/a);var g;geocoder.geocode({address:address1},function(l,k){if(k===google.maps.GeocoderStatus.OK){map.setCenter(l[0].geometry.location);pos=l[0].geometry.location;var d=new google.maps.Marker({map:map,position:pos,icon:iconBase+"airport_terminal_xs_inv.png"});g=pos;geocoder.geocode({address:address2},function(q,p){if(p===google.maps.GeocoderStatus.OK){map.setCenter(q[0].geometry.location);pos=q[0].geometry.location;var o=new google.maps.Marker({map:map,position:pos,icon:iconBase+"airport_terminal_xs_inv.png"});var n=new google.maps.Polyline({path:[g,pos],geodesic:true,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});bounds.extend(g);bounds.extend(pos);n.setMap(map);map.fitBounds(bounds);map.panToBounds(bounds);var m=new google.maps.LatLng(g.lat()+(pos.lat()-g.lat())*h,g.lng()+(pos.lng()-g.lng())*h);var o=new google.maps.Marker({map:map,position:m,icon:markerImage})}else{console.log("Geocode was not successful for the following reason: "+p)}})}else{console.log("Geocode was not successful for the following reason: "+k)}})}$(function(){$.getJSON(__site_url+"/"+__xhr_controller+"/xhr_realtime",function(a){$.each(a,function(b,c){geocode_2(c)})})});